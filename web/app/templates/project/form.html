<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Form</title>
  <!-- css -->
  <link rel="stylesheet" href="/static/css/form.css">


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

  <!-- Bootstrap-Icon -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">

  <!-- FontAwesome-Icon -->
  <script src="https://kit.fontawesome.com/87f04edde9.js" crossorigin="anonymous"></script>

  <!-- Pikaday CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pikaday/css/pikaday.min.css">

  <!-- Moment.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>

  <!-- Pikaday JS -->
  <script src="https://cdn.jsdelivr.net/npm/pikaday/pikaday.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/pikaday/plugins/pikaday.jquery.min.js"></script>


</head>

<body>
  <form id="myForm" action="/form" method="post" autocomplete="off" enctype="multipart/form-data">


    <p class="pop-up-header">เอกสารคำสั่ง</p>

    <!-----------------------------------1st part----------------------------------->
    <div class="tab" id="tab-1">
      <div class="tab-container">
        <p class="attachment">1 ) ส่วนหัวข้อของเอกสาร</p>

        <div class="form-group">
          <label>เลขที่คำสั่ง</label>
          <input type="text" placeholder="เลขที่คำสั่ง" id="refer_num" name="ref_num" required>
        </div>

        <div class="form-group">
          <label>เอกสารลงวันที่</label>
          <!--this input is id of order_table-->
          <input type="hidden" name="id" value="">
          <!--this input is user id set default to 1-->
          <input type="hidden" name="user_id" id="usr_id" value="2">
          <!-- Separate select elements for day, month, and year -->
          <input type="text" id="thaiDatePicker" placeholder="วันที่" name="thaiDate" required>
          <i class="bi bi-plus"></i>
        </div>



        <input type="hidden" id="date_combind" name="doc_date"required></input>
        <div class="form-group-subject">
          <label for="subject">เรื่อง</label>
          <textarea id="descrip" name="subject" required></textarea>
        </div>
      </div>

    </div>

    <!-----------------------------------2nd part----------------------------------->
    <div class="tab" id="tab-2">
      <div class="tab-container">
        <p class="attachment">2 ) รายชื่อคณะกรรมการ</p>
        <div class="form-group-2">
          <div class="form-head">
            <h3>รายชื่อคณะกรรมการ</h3>
            <textarea id="name_list" name="ref_name"></textarea>
          </div>
        </div>
      </div>
    </div>

    <!-----------------------------------3rd part----------------------------------->
    <div class="tab" id="tab-3">
      <div class="tab-container">
        <p class="attachment">3 ) ไฟล์แนบ</p>
        <div class="form-group-3">
          <div id="drag-and-drop" ondrop="handleDrop(event)" ondragover="allowDrop(event)">
            <h1>ลากและวางไฟล์ที่นี่</h1>
            <p class="or">หรือ</p>
            <input type="file" id="file-input" name="doc_data" style="display:none;" onchange="handleFileSelect(event)"
              accept=".pdf">
            <p class="click-to-add"><label for="file-input">กดเพื่อเลือกไฟล์แนบ</label></p>
          </div>

          <div id="uploaded-file-container">
            <h3>ชื่อไฟล์</h3>
            <div class="file-container">
              <p id="uploaded-file-name">Your file name here</p>
              <i class="bi bi-check-circle-fill" style="color: #3EBC2A;"></i>
              <span id="remove-btn" onclick="removeUploadedFile()"><i class="bi bi-trash-fill"></i> </span>
            </div>

          </div>
        </div>
      </div>

      <div class="index-btn-wrapper">
        <button class="index-btn" type="submit" name="submit"><i
            class="fa-regular fa-floppy-disk"></i>บันทึกเอกสารคำสั่ง</button>
      </div>
    </div>
  </form>

  <script src="/static/js/form.js"></script>

</body>

<!-----------------------------------database----------------------------------->
<script>
  $(document).ready(function () {
    $("#myForm").submit(function (event) {
      // prevent default html form submission action
      //event.preventDefault();
      event.preventDefault();
      document.getElementById("date_combind").value = document.getElementById("daySelect").value + " " + document.getElementById("monthSelect").value + " " + document.getElementById("yearSelect").value
      // Create a new FormData object
      var formData = new FormData();
      name_list = document.getElementById("name_list").value
      name_list = name_list.split("\n")
      console.log(name_list)
      // Log the formData to verify its content
      console.log(formData);

      // Append the file to the FormData object
      var file = $('input[name="doc_data"]')[0].files[0];
      formData.append('doc_data', file);

      // Add other form data to the FormData object
      formData.append('subject', $('#descrip').val());
      formData.append('doc_date', $('#date_combind').val());
      formData.append('ref_num', $('#refer_num').val());
      formData.append('ref_year', $('#yearSelect').val());
      formData.append('name_list', name_list);
      formData.append('user_id', $('#usr_id').val());


      console.log(formData);
      var $form = $(this);
      var url = $form.attr("action");
      $.ajax({
        type: 'POST',
        url: url,
        data: formData,
        contentType: false,
        processData: false,
        success: function (response) {
          resetForm();

        },
        error: function (error) {
          console.error('Error', error);
        }
      });
    });

    // Initialize the Thai date picker
    function setupThaiDatePicker() {
      const thaiDatePicker = new Pikaday({
        field: document.getElementById('thaiDatePicker'),
        format: 'DD/MM/YYYY',
        i18n: {
          previousMonth: 'เดือนก่อนหน้า',
          nextMonth: 'เดือนถัดไป',
          months: ['มกราคม', 'กุมภาพันธ์', 'มีนาคม', 'เมษายน', 'พฤษภาคม', 'มิถุนายน', 'กรกฎาคม', 'สิงหาคม', 'กันยายน', 'ตุลาคม', 'พฤศจิกายน', 'ธันวาคม'],
          weekdays: ['อาทิตย์', 'จันทร์', 'อังคาร', 'พุธ', 'พฤหัสบดี', 'ศุกร์', 'เสาร์'],
          weekdaysShort: ['อา', 'จ', 'อ', 'พ', 'พฤ', 'ศ', 'ส'],
        },
        onSelect: function () {
          const selectedDate = thaiDatePicker.getDate();
          const selectedYear = selectedDate.getFullYear();
          const thaiBuddhistYear = convertToThaiBuddhistYear(selectedYear);
          const inputField = document.getElementById('thaiDatePicker');
          inputField.value = inputField.value.replace(/\d{4}\s*/, thaiBuddhistYear); // Replace the year part of the input value
        }
      });

      // Function to check if a year is in the Thai Buddhist calendar and convert it if necessary
      function convertToThaiBuddhistYear(year) {
        const currentYear = new Date().getFullYear(); // Get the current Gregorian year
        return year >= 1900 && year <= currentYear ? year + 543 : year; // Convert to Thai Buddhist year if in range
      }

      // Set a default date
      const defaultDate = new Date();
  thaiDatePicker.setDate(defaultDate); 
    }

    // Call the setup function to initialize the Thai date picker
    setupThaiDatePicker();

  });



</script>

</body>

</html>